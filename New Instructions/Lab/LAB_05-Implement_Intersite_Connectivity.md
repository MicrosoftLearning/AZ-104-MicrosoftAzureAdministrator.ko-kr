---
lab:
  title: '랩 05: 사이트 간 커넥트 구현'
  module: Administer Intersite Connectivity
---

# 랩 05 - 사이트 간 연결 구현

## 랩 소개

이 랩에서는 가상 네트워크 간의 통신을 살펴봅니다. 가상 네트워크 피어링을 구현하고 원격 명령을 실행하여 연결을 테스트합니다.   

이 랩에는 Azure 구독이 필요합니다. 구독 유형은 이 랩의 기능 가용성에 영향을 줄 수 있습니다. 지역을 변경할 수 있지만 단계는 미국** 동부를 사용하여 **작성됩니다. 

## 예상 소요 시간: 30분

## 랩 시나리오 

조직은 제조 부서를 포함하여 비즈니스의 다른 부분에서 핵심 IT 앱 및 서비스(예: DNS 및 보안 서비스)를 분할합니다. 그러나 일부 시나리오에서는 핵심 영역의 앱 및 서비스가 제조 영역의 앱 및 서비스와 통신해야 합니다. 이 랩에서는 분할된 영역 간의 연결을 구성합니다. 이는 프로덕션을 개발에서 분리하거나 한 자회사를 다른 자회사와 분리하는 일반적인 시나리오입니다.

## 대화형 랩 시뮬레이션

이 항목에 유용할 수 있는 몇 가지 대화형 랩 시뮬레이션이 있습니다. 시뮬레이션을 사용하면 비슷한 시나리오를 원하는 속도로 클릭할 수 있습니다. 대화형 시뮬레이션과 이 랩 사이에는 차이점이 있지만, 대부분의 핵심 개념은 동일합니다. Azure 구독은 필요하지 않습니다. 

+ [글로벌 가상 네트워크 피어링을](https://mslabs.cloudguides.com/guides/AZ-700%20Lab%20Simulation%20-%20Connect%20two%20Azure%20virtual%20networks%20using%20global%20virtual%20network%20peering) 사용하여 두 개의 Azure 가상 네트워크를 커넥트. 서로 다른 가상 네트워크에서 두 가상 머신 간의 연결을 테스트합니다. 가상 네트워크 피어링을 만들고 다시 테스트합니다.
+ [사이트 간 연결을 구현합니다](https://mslabs.cloudguides.com/en-us/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%209). 템플릿을 실행하여 여러 가상 머신을 사용하여 가상 네트워크 인프라를 만듭니다. 가상 네트워크 피어링을 구성하고 연결을 테스트합니다. 

## 아키텍처 다이어그램

![랩 05 아키텍처 다이어그램](../media/az104-lab05-architecture-diagram.png)

## 작업

+ 작업 1: 핵심 서비스 가상 머신 및 가상 네트워크를 만듭니다.
+ 작업 2: 제조 서비스 가상 머신 및 가상 네트워크를 만듭니다.
+ 작업 3: 가상 머신 간의 연결을 테스트합니다. 
+ 작업 4: 가상 네트워크 간에 VNet 피어링을 만듭니다. 
+ 작업 5: 가상 머신 간의 연결을 다시 테스트합니다. 
 

## 작업 1: 핵심 서비스 가상 머신 및 가상 네트워크 만들기

이 작업에서는 가상 머신을 사용하여 핵심 서비스 가상 네트워크를 만듭니다. 

1. **Azure Portal** - `https://portal.azure.com`에 로그인합니다.

1. `Virtual Machines`을 검색하고 선택합니다.

1. 가상 머신 페이지에서 만들기를 선택한 **다음, Azure Virtual Machine**을 선택합니다**.**

1. 기본 사항 탭에서 다음 정보를 사용하여 양식을 완료한 다음 다음을 선택합니다 **. 디스크 >**. 지정하지 않은 설정의 경우 기본값을 그대로 둡니다.
 
    | 설정 | 값 | 
    | --- | --- |
    | 구독 |  *구독* |
    | 리소스 그룹 |  `az104-rg5` (필요한 ** 경우새로 만듭니다**. 모든 랩 리소스에 이 그룹을 사용합니다.)
    | 가상 머신 이름 |    `CoreServicesVM` |
    | 지역 | **미국 동부** |
    | 가용성 옵션 | 인프라 중복 필요 없음 |
    | 이미지 | **Windows Server 2019 Datacenter: x64 Gen2** |
    | 크기 | **Standard_DS2_v3** |
    | 사용자 이름 | `localadmin` | 
    | 암호 | **복잡한 암호 제공** |

    ![기본 가상 머신 만들기 페이지의 스크린샷. ](../media/az104-lab05-createcorevm.png)
   
1. 디스크 탭에서 OS 디스크 유형을 표준 HDD**로 **설정한 다음, 다음: 네트워킹 >** 선택합니다**.

1. 네트워킹 탭의 가상 네트워크에 대해 새로** 만들기를 선택합니다**.

1. 다음 정보를 사용하여 가상 네트워크를 구성한 다음 확인을 선택합니다****. 필요한 경우 기존 주소 범위를 제거하거나 바꿉니다.

    | 설정 | 값 | 
    | --- | --- |
    | 속성 | `CoreServicesVNet` (새로 만들기) |
    | 주소 공간 | `10.0.0.0/16`  |
    | 서브넷 이름 | `Core` | 
    | 서브넷 주소 범위 | `10.0.0.0/24` |

1. 모니터링 탭을 **** 선택합니다. 부팅 진단의 경우 사용 안 함을** 선택합니다**.

1. **검토 + 만들기**를 선택한 후 **만들기**를 선택합니다.

1. 리소스가 생성될 때까지 기다릴 필요가 없습니다. 다음 작업을 계속합니다.

    >**참고:** 이 작업에서 가상 머신을 만들 때 가상 네트워크를 만든 것을 확인했나요? 

## 작업 2: 제조 서비스 가상 머신 및 가상 네트워크 만들기

이 작업에서는 가상 머신을 사용하여 제조 서비스 가상 네트워크를 만듭니다. 

1. Azure Portal에서 Virtual Machines**를 검색하고 이동합니다**.

1. 가상 머신 페이지에서 만들기를 선택한 **다음, Azure Virtual Machine**을 선택합니다**.**

1. 기본 사항 탭에서 다음 정보를 사용하여 양식을 완료한 다음 다음을 선택합니다 **. 디스크 >**. 지정하지 않은 설정의 경우 기본값을 그대로 둡니다.
 
    | 설정 | 값 | 
    | --- | --- |
    | 구독 |  *구독* |
    | 리소스 그룹 |  `az104-rg5` |
    | 가상 머신 이름 |    `ManufacturingVM` |
    | 지역 | **미국 동부** |
    | 가용성 옵션 | 인프라 중복 필요 없음 |
    | 이미지 | **Windows Server 2019 Datacenter: x64 Gen2** |
    | 크기 | **Standard_DS2_v3** | 
    | 사용자 이름 | `localadmin` | 
    | 암호 | **복잡한 암호 제공** |

1. 디스크 탭에서 OS 디스크 유형을 표준 HDD**로 **설정한 다음, 다음: 네트워킹 >** 선택합니다**.

1. 네트워킹 탭의 가상 네트워크에 대해 새로** 만들기를 선택합니다**.

1. 다음 정보를 사용하여 가상 네트워크를 구성한 다음 확인을 선택합니다****.  필요한 경우 기존 주소 범위를 제거하거나 바꿉니다.

    | 설정 | 값 | 
    | --- | --- |
    | 속성 | `ManufacturingVNet` |
    | 주소 공간 | `172.16.0.0/16`  |
    | 서브넷 이름 | `Manufacturing` |
    | 서브넷 주소 범위 | `172.16.0.0/24` |

1. 모니터링 탭을 **** 선택합니다. 부팅 진단의 경우 사용 안 함을** 선택합니다**.

1. **검토 + 만들기**를 선택한 후 **만들기**를 선택합니다.

## 작업 3: 가상 머신 간의 연결 테스트

이 작업에서는 서로 다른 가상 네트워크의 가상 머신 간의 연결을 테스트합니다.

### CoreServicesVM의 개인 IP 주소 확인

1. Azure Portal에서 가상 머신을 `CoreServicesVM` 검색하고 선택합니다.

1. 개요** 블레이드의 **** 네트워킹** 섹션에서 컴퓨터의 **개인 IP 주소를** 기록합니다. 연결을 테스트하려면 이 정보가 필요합니다.
   
### ManufacturingVM에서 CoreServicesVM**에 대한 **연결을 테스트합니다.

1. 포털에서 가상 머신을 선택하고 선택합니다 `ManufacturingVM` .

1. **작업** 섹션에서 실행 명령** 블레이드를 **선택합니다.

1. RunPowerShellScript**를 **선택하고 **Test-Net커넥트ion** 명령을 실행합니다. CoreServicesVM**의 **개인 IP 주소를 사용해야 합니다.

   ```Powershell
    Test-NetConnection <CoreServicesVM private IP address> -port 3389
   ```
   
1. 스크립트를 실행하는 데 몇 분 정도 걸릴 수 있습니다. 페이지 위쪽에는 진행 중인 정보 메시지 *스크립트 실행이 표시됩니다.*
   
1. 테스트 연결이 실패합니다. 다른 가상 네트워크의 가상 머신은 기본적으로 통신할 수 없어야 합니다.
   
   ![Test-Net커넥트ion이 있는 PowerShell 창이 실패했습니다.](../media/az104-lab05-fail.png)

 
## 작업 4: 가상 네트워크 간에 VNet 피어링 만들기

이 작업에서는 VNet 간의 통신을 사용하도록 설정하는 가상 네트워크 피어링을 만듭니다.

1. Azure Portal에서 Virtual Network를 선택한 **다음 CoreServicesVnet**을 선택합니다**.**

1. CoreServicesVnet의 **설정**에서 **피어링**을 선택합니다.

1. CoreServicesVnet | 피어링에서 **+ 추가**를 선택합니다.

1. 다음 표의 정보를 사용하여 피어링을 만듭니다.

    | **섹션**                          | **옵션**                                    | **값**                             |
    | ------------------------------------ | --------------------------------------------- | ------------------------------------- |
    | 이 가상 네트워크                 |                                               |                                       |
    |                                      | 피어링 링크 이름                             | `CoreServicesVnet-to-ManufacturingVnet` |
    |                                      | CoreServicesVNet이 피어된 가상 네트워크에 액세스하도록 허용            | 선택됨(기본값)                       |
    |                                      | CoreServicesVNet이 피어된 가상 네트워크에서 전달된 트래픽을 수신하도록 허용 | 선택됨                       |
    |                                      | CoreServicesVNet이 피어된 가상 네트워크의 원격 게이트웨이를 사용하도록 설정       | 선택되지 않음(기본값)                        |
    | 원격 가상 네트워크               |                                               |                                       |
    |                                      | 피어링 링크 이름                             | `ManufacturingVnet-to-CoreServicesVnet` |
    |                                      | 가상 네트워크 배포 모델              | **리소스 관리자**                      |
    |                                      | 리소스 ID를 알고 있음                         | 선택 안 됨                          |
    |                                      | 구독                                  | *구독*    |
    |                                      | 가상 네트워크                               | **ManufacturingVnet**                     |
    |                                      | ManufacturingVNet이 CoreServicesVNet에 액세스하도록 허용  | 선택됨(기본값)                       |
    |                                      | ManufacturingVNet이 CoreServicesVNet에서 전달된 트래픽을 수신하도록 허용 | 선택됨                        |
    |                                      | CoreServicesVNet의 원격 게이트웨이를 사용하도록 ManufacturingVNet 사용       | 선택되지 않음(기본값)                        |

1. 설정을 검토하고 추가**를 선택합니다**.

    ![피어링 페이지의 스크린샷.](../media/az104-lab05-peering.png)
 
1. CoreServicesVnet | 피어링에서 **CoreServicesVnet-to-ManufacturingVnet** 피어링이 표시되는지 확인합니다. 페이지를 **새로 고쳐 피어링 상태** **커넥트**.

1. ManufacturingVnet**으로 **전환하고 ManufacturingVnet-CoreServicesVnet** 피어링이 나열되었는지 확인**합니다. **피어링 상태 커넥트** **있는지 확인합니다**.

 
## 작업 5: VM 간 연결 테스트

이 작업에서는 서로 다른 가상 네트워크의 가상 머신이 서로 통신할 수 있는지 확인합니다.

1. ManufacturingVM**을 **검색하여 선택합니다.

1. **작업** 섹션에서 실행 명령** 블레이드를 **선택합니다.

1. RunPowerShellScript**를 선택하고 **Test-Net커넥트ion 명령을 추가합니다. CoreServicesVM**의 **개인 IP 주소를 사용해야 합니다.

      ```Powershell
     Test-NetConnection <CoreServicesVM private IP address> -port 3389
      ```

1. 스크립트를 실행하는 데 몇 분 정도 걸릴 수 있습니다. 페이지 위쪽에는 진행 중인 정보 아이콘 *스크립트 실행이 표시됩니다.*
    
1. 테스트 연결이 성공해야 합니다. 
   ![Test-Net커넥트ion이 성공한 Powershell 창](../media/az104-lab05-success.png)


## 랩의 기본 지점 검토

랩을 완료한 것을 축하합니다. 다음은 이 랩에 대한 기본 설명입니다. 

+ 기본적으로 다른 가상 네트워크의 리소스는 통신할 수 없습니다.
+ 가상 네트워크 피어링을 사용하면 Azure에서 두 개 이상의 가상 네트워크를 원활하게 연결할 수 있습니다.
+ 피어된 가상 네트워크는 연결을 위해 하나로 표시됩니다.
+ 피어링된 가상 네트워크에 있는 가상 머신 간의 트래픽은 Microsoft 백본 인프라를 사용합니다.

## 리소스 정리

고유한 구독으로 작업하는 경우 랩 리소스를 삭제하는 데 1분이 소요됩니다. 이렇게 하면 리소스가 해제되고 비용이 최소화됩니다. 랩 리소스를 삭제하는 가장 쉬운 방법은 랩 리소스 그룹을 삭제하는 것입니다. 

+ Azure Portal에서 리소스 그룹을 선택하고, 리소스 그룹 삭제를 선택하고 **, **리소스 그룹** 이름을** 입력한 다음, 삭제**를 클릭합니다**.
+ Azure PowerShell 사용. `Remove-AzResourceGroup -Name resourceGroupName` 
+ CLI `az group delete --name resourceGroupName`를 사용하여 .

