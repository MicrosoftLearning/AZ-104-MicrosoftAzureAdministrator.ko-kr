---
lab:
  title: '랩 02a: 구독 및 RBAC 관리'
  module: Administer Governance and Compliance
---

# 랩 02a - 구독 및 RBAC 관리

## 랩 소개

이 랩에서는 역할 기반 액세스 제어에 대해 알아봅니다. 권한 및 범위를 사용하여 ID가 수행할 수 있는 작업과 수행할 수 없는 작업을 제어하는 방법을 알아봅니다. 관리 그룹을 사용하여 구독 관리를 더 쉽게 만드는 방법도 알아봅니다. 

이 랩에는 Azure 구독이 필요합니다. 구독 유형은 이 랩의 기능 가용성에 영향을 줄 수 있습니다. 지역을 변경할 수 있지만 단계는 미국** 동부를 사용하여 **작성됩니다. 

## 예상 소요 시간: 30분

## 랩 시나리오

조직에서 Azure 리소스 관리를 간소화하기 위해 다음 기능을 구현해야 합니다.

- 모든 Azure 구독을 포함하는 관리 그룹 만들기

- 관리 그룹의 모든 구독에 대한 지원 요청을 지정된 사용자에게 제출할 수 있는 권한을 부여합니다. 해당 사용자의 사용 권한은 다음으로만 제한되어야 합니다. 

    - 지원 요청 티켓 만들기
    - 리소스 그룹 보기

## 대화형 랩 시나리오

이 항목에 유용할 수 있는 몇 가지 대화형 랩 시뮬레이션이 있습니다. 시뮬레이션을 사용하면 비슷한 시나리오를 원하는 속도로 클릭할 수 있습니다. 대화형 시뮬레이션과 이 랩 사이에는 차이점이 있지만, 대부분의 핵심 개념은 동일합니다. Azure 구독은 필요하지 않습니다. 

+ [RBAC를 사용하여 액세스를 관리합니다](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2014). 사용자에게 기본 제공 역할을 할당하고 활동 로그를 모니터링합니다. 

+ [구독 및 RBAC](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%202)를 관리합니다. 관리 그룹을 구현하고 사용자 지정 RBAC 역할을 만들고 할당합니다.

+ [지원 요청을](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%2022) 엽니다. 지원 계획 옵션을 검토한 다음 지원 요청, 기술 또는 청구를 만들고 모니터링합니다.

## 아키텍처 다이어그램

![랩 작업의 다이어그램.](../media/az104-lab02a-architecture.png)

## 작업

+ 작업 1: 관리 그룹을 구현합니다.
+ 작업 2: 기본 제공 Azure 역할을 검토하고 할당합니다.
+ 작업 3: 지원 센터에 대한 사용자 지정 RBAC 역할을 만듭니다.
+ 작업 4: 사용자 지정 역할을 테스트하여 올바른 권한이 있는지 확인합니다.
+ 작업 5: 활동 로그를 사용하여 역할 할당을 모니터링합니다.

## 작업 1: 관리 그룹 구현

이 작업에서는 관리 그룹을 만들고 구성합니다. 관리 그룹은 구독을 논리적으로 구성하는 데 사용됩니다. 구독을 분할하고 RBAC 및 Azure Policy를 할당하고 다른 관리 그룹 및 구독에 상속할 수 있도록 해야 합니다. 예를 들어 조직에 유럽 전용 지원 팀이 있는 경우 유럽 구독을 관리 그룹으로 구성하여 모든 구독에 대한 개별 액세스를 제공하지 않고도 지원 직원에게 해당 구독에 대한 액세스 권한을 제공할 수 있습니다. 이 시나리오에서는 지원 센터의 모든 사용자가 모든 구독에서 지원 요청을 만들어야 합니다. 

1. **Azure Portal** - `https://portal.azure.com`에 로그인합니다.

1. `Management groups`을 검색하고 선택합니다.

1. **관리 그룹** 블레이드 상단에 있는 메시지를 검토합니다. 디렉터리 관리자로 등록되었지만 루트 관리 그룹에** 액세스하는 데 필요한 권한이 없다는 메시지가 **표시되는 경우 다음 일련의 단계를 수행합니다.

    + Azure Portal에서 **Microsoft Entra ID**를 검색하여 선택합니다.
    
    + 테넌트 속성을 표시하는 블레이드의 왼쪽 세로 **메뉴에서 [관리**] 섹션에서 [속성]**을 선택합니다**.
    
    + **테넌트 **속성** 블레이드의 Azure 리소스**에 대한 액세스 관리 섹션에서 예를** 선택하고 **저장**을 선택합니다**.
    
    + 관리 그룹 블레이드로 **돌아가서 새로 고침**을 선택합니다**.**

1. **관리 그룹** 블레이드에서 **+ 만들기**를 클릭합니다.

1. 다음 설정을 사용하여 관리 그룹을 만듭니다. 완료되면 제출**을 선택합니다**. 

    | 설정 | 값 |
    | --- | --- |
    | 관리 그룹 ID | `az104-mg1` |
    | 관리 그룹 표시 이름 | `az104-mg1` |

1. 이 시나리오에서는 이제 모든 구독이 관리 그룹에 추가됩니다. 그러면 RBAC가 관리 그룹에 적용되고 지원 센터로 범위가 지정됩니다. 

## 작업 2: 기본 제공 Azure 역할 검토 및 할당

이 작업에서는 기본 제공 역할을 검토하고 사용자 계정에 VM 기여자 역할을 할당합니다. Azure는 많은 수의 [기본 제공 역할을](https://learn.microsoft.com/azure/role-based-access-control/built-in-roles) 제공합니다.

1. 포털에서 az104-mg1** 관리 그룹을 검색합니다**.

1. **액세스 제어(IAM)** 블레이드를 선택한 다음 역할** 탭을 **선택합니다.

1. 사용 가능한 역할 정의를 스크롤합니다. **역할을 확인**하여 사용 권한 **, **JSON** 및 **할당에 **대한 자세한 정보를 가져옵니다**. 

1. + 추가를 선택하고 **드롭다운 메뉴에서 역할 할당** 추가를 선택합니다**.** 

1. **역할 할당 추가** 블레이드에서 다음 설정을 지정하고 각 단계 후 **다음**을 클릭합니다.

    | 설정 | 값 |
    | --- | --- |
    | 이 역할 선택 | **가상 머신 참가자** |
    | 액세스 권한 할당(멤버 창 아래) | **사용자, 그룹 또는 서비스 주체** |
    | (+멤버 선택) 선택 | *사용자 계정* (포털의 오른쪽 위 모서리에 표시됨) |

4. **검토 + 할당**을 두 번 클릭하여 역할 할당을 만듭니다.

    >**참고:** 가상 머신 기여자 역할을 사용하면 가상 머신을 관리할 수 있지만 해당 운영 체제에 액세스하거나 연결된 가상 네트워크 및 스토리지 계정을 관리할 수는 없습니다.

    >**참고:** 이 할당은 실제로 추가 도발을 부여하지 않을 수 있습니다. 소유자 역할이 이미 있는 경우 이 역할에는 기여자 역할과 연결된 모든 권한이 포함됩니다.


## 작업 3: 지원 센터에 대한 사용자 지정 RBAC 역할 만들기

이 작업에서는 사용자 지정 RBAC 역할을 만듭니다. 사용자 지정 역할은 환경에 대한 최소 권한 원칙을 구현하는 핵심 부분입니다. 기본 제공 역할에는 조직에 대한 권한이 너무 많을 수 있습니다. 이 작업에서는 새 역할을 만들고 필요하지 않은 권한을 제거합니다.

1. 포털에서 az104-mg1** 관리 그룹을 검색하여 선택합니다**.

1. **액세스 제어(IAM)** 블레이드를 선택한 다음 액세스** 확인 탭을 **선택합니다.

 1. **사용자 지정 역할** 만들기 상자에서 추가**를 선택합니다**.

1. 사용자 지정 역할** 만들기의 **기본 사항 탭에서 이름을 `Custom Support Request`입력합니다. 설명 필드에 를 입력합니다. `A custom contributor role for support requests.`  

1. 기준 권한 필드에서 역할** 복제를 선택합니다**. 역할 복제 드롭다운 메뉴에서 지원 요청 기여자를** 선택합니다**.

    ![역할을 복제하는 스크린샷](../media/az104-lab02a-clone-role.png)

1. 사용 권한 탭을 **** 선택한 다음+ 사용 권한 제외를** 선택합니다**.

1. 리소스 공급자 검색 필드에 Microsoft.Support를 입력 `.Support` 하고 선택합니다 **.**

1. 사용 권한 목록에서 기타: 지원 리소스 공급자 등록 옆에 **검사 상자를 놓고 추가**를 선택합니다**.** 이 권한을 NotAction*으로 *포함하도록 역할을 업데이트해야 합니다.

    >**참고:** Azure 리소스 공급자는 특정 Azure 서비스에 대한 기능을 사용하도록 설정하는 REST 작업 집합입니다. 지원 센터에서 이 기능을 사용할 수 있기를 원하지 않으므로 역할에서 제거되고 있습니다. 

1. **할당 가능한 범위 탭을** 선택합니다. 구독의 **행에서 삭제** 아이콘을 선택합니다.

1. + 할당 가능한 범위 추가를** 선택합니다**. **az104-mg1** 관리 그룹을 선택한 다음 선택을** 클릭합니다**.

1. JSON 탭을 **선택합니다. 역할에서 사용자 지정된 작업 *, *NotActions* 및 *AssignableScopes에 대한 *JSON을 검토합니다*.** 

1. Selct **검토 + 만들기**를 선택한 다음 만들기**를 선택합니다**.

    >**참고:** 이 시점에서 사용자 지정 역할을 만들었습니다. 다음 단계는 지원 센터 사용자에게 역할을 할당하는 것입니다. 

작업 4: 사용자 지정 RBAC 역할을 할당하고 테스트합니다.

이 작업에서는 테스트 사용자에게 사용자 지정 역할을 추가하고 해당 권한을 확인합니다. 

1. Azure Portal에서 Microsoft Entra ID**를 검색하여 선택한 **다음, 사용자** 블레이드를 **선택합니다.

    >**참고**: 이 작업을 수행하려면 테스트용 사용자 계정이 필요합니다. 이 랩에서는 helpdesk-user1**을 사용합니다**. 테스트 사용자를 식별하려면 잠시 시간을 내세요. 필요한 경우 새 사용자를 추가할** 수 있습니다**. 새 사용자를 만드는 경우 로그인할 때 암호를 설정해야 합니다. 

1. 계속하기 전에 테스트 계정의 **사용자 계정 이름이** 있는지 확인합니다. 포털에 로그인하려면 이 항목이 필요합니다. 아이콘을 사용하여 이 정보를 클립보드에 복사합니다. 

1. Azure Portal에서 az104-mg1** 관리 그룹으로 다시 **이동합니다.

1. **액세스 제어(IAM)** 를 클릭하고 **+추가**를 클릭한 다음 **역할 할당 추가**를 클릭합니다. 

1. 역할 탭에서 **을 검색합니다`Custom Support Request`.** 

    >**참고**: 사용자 지정 역할이 표시되지 않으면 사용자 지정 역할을 만든 후 표시하는 데 최대 5분이 걸릴 수 있습니다. 페이지를 **새로 고칩니다**. 

1. **역할**을 선택하고 **다음**을 클릭합니다. [구성원] 탭에서 **[ + 구성원** **선택]을 클릭하고 **사용자 계정 **hellpdesk-user1**을 선택합니다**.**  

1. 검토를 선택하고 **두 번 할당** 합니다.

    >**참고:** 이 시점에서 지원 티켓을 만들 수 있는 사용자 지정 권한이 있는 지원 센터 사용자 계정이 있습니다. 다음 단계는 계정을 테스트하는 것입니다.
    
## 작업 4: 사용자 지정 역할을 테스트하여 올바른 권한이 있는지 확인합니다.

1. **InPrivate** 브라우저 창을 열고 에서 `https://portal.azure.com`Azure Portal로 이동합니다.

1. helpdesk-user1에 대한 사용자 원칙 이름을 제공합니다. 암호를 업데이트하라는 메시지가 표시되면 사용자 암호를 변경합니다.

1. InPrivate** 브라우저 창의 **Azure Portal에서 리소스 그룹을 검색하고 선택하여 **지원 센터 사용자가 리소스 그룹을** 볼 수 있는지 확인합니다.

1. InPrivate** 브라우저 창의 **Azure Portal에서 모든 리소스를** 검색하고 선택하여 **지원 센터 사용자가 개별 리소스를 볼 수 없는지 확인합니다.

1. **InPrivate** 브라우저 창의 Azure Portal에서 **도움말 + 지원**을 검색하여 선택한 다음 **+ 지원 요청 만들기**를 클릭합니다. 

    >**참고**: 많은 조직에서 모든 클라우드 관리자에게 오픈 지원 사례에 대한 액세스를 제공하기로 결정합니다. 이렇게 하면 관리자가 지원 사례를 더 빠르게 해결할 수 있습니다.

1. **InPrivate** 브라우저 창에 있는 **도움말 + 지원 - 새 지원 요청** 블레이드의 **문제 설명/요약** 탭으로 이동합니다. 요약 필드에 **서비스 및 구독 제한**을 입력하고 **서비스 및 구독 제한(할당량)** 문제 유형을 선택합니다. 이 랩에서 사용 중인 구독이 **구독** 드롭다운 목록에 나열됩니다.

    >**참고**: 역할이 관리 그룹에 할당되었으므로 모든 구독을 도움말 설명에 사용할 수 있어야 합니다. 서비스 및 구독 제한(할당량)** 옵션이 표시되지 **않으면 Azure Portal에서 로그아웃하고 다시 로그인합니다.

1. 새 지원 요청 만들기를 **탐색하는 데 몇 분 정도 걸리지만 지원 요청을** 계속 만들지는 마세요. 대신 Azure Portal에서 지원 센터 사용자로 로그아웃하고 InPrivate 브라우저 창을 닫습니다.

    >**참고:** 이제 지원 센터 사용자에게 올바른 권한이 있는지 확인했습니다. 이때 지원 센터 그룹을 만들고 구성원을 추가합니다. 

## 작업 5: 활동 로그를 사용하여 역할 할당 모니터링

이 작업에서는 활동 로그를 확인하여 새 역할을 만든 사람이 있는지 확인합니다. 

1. 포털로 돌아가서 az104-mg1 리소스에서 **활동 로그**를 선택합니다**.**

2. 필터** 추가를 선택하고 **작업을** 선택한 **다음 **역할 할당**을 만듭니다.

    ![구성된 필터가 있는 활동 로그 페이지의 스크린샷.](../media/az104-lab02a-searchactivitylog.png)

3. 활동 로그에 역할 만들기 활동이 표시되는지 확인합니다. 

## 핵심 내용

랩을 완료한 것을 축하합니다. 다음은 이 랩에 대한 기본 설명입니다. 

+ 관리 그룹은 구독을 논리적으로 구성하는 데 사용됩니다.
+ Azure에는 많은 기본 제공 역할이 있습니다. 이러한 역할을 할당하여 리소스에 대한 액세스를 제어할 수 있습니다.
+ 새 역할을 만들거나 기존 역할을 사용자 지정할 수 있습니다.
+ 역할은 JSON 형식 파일로 정의되며 Actions *, *NotActions* 및 *AssignableScopes를* 포함합니다*.
+ 활동 로그를 사용하여 역할 할당을 모니터링할 수 있습니다. 

## 리소스 정리

고유한 구독으로 작업하는 경우 랩 리소스를 삭제하는 데 1분이 소요됩니다. 이렇게 하면 리소스가 해제되고 비용이 최소화됩니다. 랩 리소스를 삭제하는 가장 쉬운 방법은 랩 리소스 그룹을 삭제하는 것입니다. 

+ Azure Portal에서 리소스 그룹을 선택하고, 리소스 그룹 삭제를 선택하고 **, **리소스 그룹** 이름을** 입력한 다음, 삭제**를 클릭합니다**.
+ Azure PowerShell 사용. `Remove-AzResourceGroup -Name resourceGroupName` 
+ CLI `az group delete --name resourceGroupName`를 사용하여 .


