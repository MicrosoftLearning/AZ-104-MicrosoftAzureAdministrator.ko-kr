# 랩 04 - 가상 네트워킹 구현

## 랩 소개

이 랩은 가상 네트워킹에 중점을 둔 세 개의 랩 중 첫 번째 랩입니다. 이 랩에서는 가상 네트워킹 및 서브넷의 기본 사항에 대해 알아봅니다. 네트워크 보안 그룹 및 애플리케이션 보안 그룹을 사용하여 네트워크를 보호하는 방법도 알아봅니다. 

이 랩에는 Azure 구독이 필요합니다. 구독 유형은 이 랩의 기능 가용성에 영향을 줄 수 있습니다. 지역을 변경할 수 있지만 단계는 미국** 동부 및 **서유럽**을 사용하여 **작성됩니다. 

## 예상 시간: 40분

## 랩 시나리오 

글로벌 조직은 가상 네트워크를 구현할 계획입니다. 이러한 네트워크는 미국 동부, 서유럽 및 동남 아시아에 있습니다. 즉각적인 목표는 모든 기존 리소스를 수용하는 것입니다. 그러나 조직은 성장 단계에 있으며 성장을 위한 추가 용량이 있는지 확인하려고 합니다.

**CoreServicesVnet** 가상 네트워크는 **미국 동부** 지역에 배포됩니다. 이 가상 네트워크에는 가장 많은 리소스가 있습니다. 네트워크는 VPN 연결을 통해 온-프레미스 네트워크에 연결됩니다. 이 네트워크에는 비즈니스 운영의 핵심인 웹 서비스, 데이터베이스 및 기타 시스템이 있습니다. do기본 컨트롤러 및 DNS와 같은 공유 서비스는 여기에 있습니다. 많은 양의 증가가 예상되므로 이 가상 네트워크에는 대용량 주소 공간이 필요합니다.

**ManufacturingVnet** 가상 네트워크는 조직의 제조 시설 위치와 가까운 **서유럽** 지역에 배포됩니다. 이 가상 네트워크에는 제조 시설 운영을 위한 시스템이 포함되어 있습니다. 조직은 시스템이 온도와 같은 데이터를 검색할 수 있도록 많은 수의 내부 연결된 디바이스를 예상하고 있으며 확장할 수 있는 IP 주소 공간이 필요합니다.

## 대화형 랩 시뮬레이션

이 항목에 유용할 수 있는 몇 가지 대화형 랩 시뮬레이션이 있습니다. 시뮬레이션을 사용하면 비슷한 시나리오를 원하는 속도로 클릭할 수 있습니다. 대화형 시뮬레이션과 이 랩 사이에는 차이점이 있지만, 대부분의 핵심 개념은 동일합니다. Azure 구독은 필요하지 않습니다. 

+ [간단한 가상 네트워크를](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%204) 만듭니다. 두 개의 가상 머신이 있는 가상 네트워크를 만듭니다. 가상 머신이 통신할 수 있음을 보여 줍니다. 

+ [Azure](https://mslabs.cloudguides.com/guides/AZ-700%20Lab%20Simulation%20-%20Design%20and%20implement%20a%20virtual%20network%20in%20Azure)에서 가상 네트워크를 디자인하고 구현합니다. 리소스 그룹을 만들고 서브넷을 사용하여 가상 네트워크를 만듭니다.  

+ [가상 네트워킹을 구현합니다](https://mslabs.cloudguides.com/en-us/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%208). 가상 네트워크를 만들고 구성하고, 가상 머신을 배포하고, 네트워크 보안 그룹을 구성하고, Azure DNS를 구성합니다.

## 아키텍처 다이어그램

![네트워크 레이아웃](../media/az104-lab04-arch-diagram.png)

이러한 가상 네트워크 및 서브넷은 기존 리소스를 수용하면서도 예상된 성장을 허용하는 방식으로 구성됩니다. 이러한 가상 네트워크 및 서브넷을 만들어 네트워킹 인프라의 기반을 구축해 보겠습니다.

>**알고 계셨나요?**: IP 주소 범위가 겹치지 않도록 하여 문제를 줄이고 문제 해결을 간소화하는 것이 좋습니다. 겹치는 것은 클라우드 또는 온-프레미스에서 전체 네트워크에서 우려됩니다. 많은 조직에서 겹치지 않도록 엔터프라이즈 전체 IP 주소 지정 체계를 설계하고 향후 성장을 계획합니다.

## 작업

+ 작업 1: 리소스 그룹을 만듭니다.
+ 작업 2: CoreServicesVnet 가상 네트워크 및 서브넷을 만듭니다.
+ 작업 3: ManufacturingVnet 가상 네트워크 및 서브넷을 만듭니다.
+ 작업 4: 애플리케이션 보안 그룹과 네트워크 보안 그룹 간의 통신을 구성합니다. 


## 작업 1: 리소스 그룹 만들기

### 이 랩의 모든 리소스에 대한 리소스 그룹을 만듭니다. 

1. **Azure Portal** - `https://portal.azure.com`에 로그인합니다.

1. 리소스 그룹을** 검색하여 선택한 **다음+ 만들기**를 선택합니다**.  

1. 이러한 설정을 사용하여 리소스 그룹을 만듭니다. 

    | **Tab**         | **옵션**                                 | **값**            |
    | --------------- | ------------------------------------------ | -------------------- |
    | 기본 사항          | Resource group                             | `az104-rg4` |
    |                 | 지역                                     | (미국) **미국 동부**     |
    | 태그            | 변경 필요 없음                        |                      |
   
1. 완료되면 검토 + 만들기**를 선택한 다음 **만들기**를 선택합니다**.
   
## 작업 2: CoreServicesVnet 가상 네트워크 및 서브넷 만들기

조직은 핵심 서비스에 대해 많은 성장을 계획하고 있습니다. 이 작업에서는 기존 리소스 및 계획된 증가를 수용하기 위해 가상 네트워크 및 연결된 서브넷을 만듭니다.

1. Virtual Network**를 검색하고 선택합니다**.

1. 가상 네트워크 페이지에서 만들기를 선택하고 **기본 및 **** IPv4 주소를 완료**합니다**.** 

1. 다음 표의 정보를 사용하여 CoreServicesVnet 가상 네트워크를 만듭니다.  

    | **Tab**      | **옵션**         | **값**            |
    | ------------ | ------------------ | -------------------- |
    | 기본 사항       | 리소스 그룹     | **az104-rg4** |
    |              | 이름               | `CoreServicesVnet`     |
    |              | 지역             | (미국) **미국 동부**         |
    | IP 주소 | IPv4 주소 공간 | `10.20.0.0/16` (IP 주소 공간 삭제 또는 덮어쓰기)     |


1. 서브넷 영역에서 기본** 서브넷을 **삭제합니다.

1. **+ 서브넷 추가**를 선택합니다. 각 서브넷의 이름 및 주소 정보를 완료합니다. 새 서브넷마다 추가**를 선택**해야 합니다. 

    | **서브넷**             | **옵션**           | **값**              |
    | ---------------------- | -------------------- | ---------------------- |
    | SharedServicesSubnet   | 서브넷 이름          | `SharedServicesSubnet`   |
    |                        | 시작 주소     | `10.20.10.0`          |
    |                        | 크기                 | `/24` |
    | DatabaseSubnet         | 서브넷 이름          | `DatabaseSubnet`         |
    |                        | 시작 주소     | `10.20.20.0`        |
    |                        | 크기                 | `/24` |

1. CoreServicesVnet 및 연결된 서브넷 만들기를 마치려면 **검토 + 만들기**를 선택합니다.

1. 구성이 유효성 검사를 통과했는지 확인한 다음 **만들기**를 선택합니다.

1. 가상 네트워크가 배포되기를 기다린 다음 리소스**로 이동을 선택합니다**. 

1. **Automation** 섹션에서 템플릿** 내보내기를 선택한 **다음 템플릿이 생성될 때까지 기다립니다.

1. **템플릿을 다운로드** 합니다.

1. 로컬 컴퓨터에서 다운로드 폴더로 이동하고 **다운로드한 zip 파일의 모든** 파일을 추출합니다.**** 

1. 계속하기 전에 template.json 및 **parameters.json** 파일 **2개가 있는지 확인합니다**. 잠시 시간을 내어 CoreServicesVnet에 대한 파일 및 정보를 검토합니다. 이 템플릿을 사용하여 다음 작업에서 ManufacturingVnet을 만듭니다. 
 
## 작업 3: ManufacturingVnet 가상 네트워크 및 서브넷 만들기

이 작업에서는 ManufacturingVnet 가상 네트워크 및 연결된 서브넷을 만듭니다. 이 조직은 제조 사무소의 성장을 예상하므로 서브넷의 크기는 예상 증가에 적합합니다.

1. **이전 작업에서 내보낸 template.json** 파일을 찾습니다. 다운로드** 폴더에 **있어야 합니다.

1. 선택한 편집기를 사용하여 파일을 편집합니다. Visual Studio Code를 사용하는 경우 제한된 모드**가 아닌 신뢰할 수 있는 창**에서 **작업**하고 있는지 확인합니다.

   >**참고:** 이 작업의 경우 템플릿을 편집하고 다시 배포하는 방법을 보여 드립니다. 너무 혼동되면 완성된 템플릿이 제공됩니다. 

### ManufacturingVnet 가상 네트워크를 변경합니다.

1. CoreServicesVnet**`ManufacturingVnet`의 **모든 항목을 . 

1. eastus**의 **모든 항목을 .로 대체`westeurope`합니다. 

1. 10.20.0.0/16**`10.30.0.0/16`의 **모든 항목을 . 

### ManufacturingVnet 서브넷을 변경합니다.

1. SharedServicesSubnet**의 **모든 항목을 .로 `SensorSubnet1`변경합니다.

1. 10.20.10.0/24**`10.30.20.0/24`의 **모든 항목을 .로 변경합니다.

1. DatabaseSubnet**의 **모든 항목을 .로 `SensorSubnet2`변경합니다.

1. 10.20.20.0/24**`10.30.21.0/24`의 **모든 항목을 .로 변경합니다.

1. 파일을 다시 읽고 모든 것이 올바른지 확인합니다.

1. 변경 내용을 **저장**합니다.

### 사용자 지정 템플릿 배포

1. 포털에서 사용자 지정 템플릿** 배포를 검색하여 선택합니다**.

1. 편집**기에서 사용자 고유의 템플릿 빌드를 선택한 다음 **, 파일** 로드를 선택합니다**.

1. 제조 변경 내용이 **포함된 templates.json** 파일을 선택한 다음 저장**을 선택합니다**.

1. **검토 + 만들기**를 선택한 다음, **만들기**를 선택합니다.

1. 템플릿이 배포되기를 기다린 다음(포털에서) 제조 가상 네트워크가 생성되었는지 확인합니다. 
   
## 작업 4: 애플리케이션 보안 그룹과 네트워크 보안 그룹 간의 통신 구성 

이 작업에서는 애플리케이션 보안 그룹 및 네트워크 보안 그룹을 만듭니다. NSG에는 ASG의 트래픽을 허용하는 인바운드 보안 규칙이 있습니다. 

### ASG(애플리케이션 보안 그룹) 만들기

1. Azure Portal에서 애플리케이션 보안 그룹을** 검색하고 선택합니다**.

1. 만들기**를 클릭하고 **기본 정보를 제공합니다.

    | 설정 | 값 |
    | -- | -- |
    | 구독 | *구독* |
    | 리소스 그룹 | **az104-rg4** |
    | 이름 | `asg-web` |
    | 지역 | **(미국) 미국 동부**  |

1. 검토 + 만들기를 클릭한 **다음 유효성 검사 후 만들기**를 클릭합니다**.**

### 네트워크 보안 그룹을 만들고 ASG 서브넷과 연결

1. Azure Portal에서 **네트워크 보안 그룹**을 검색하여 선택합니다.

1. +만들기**를 선택하고 **기본** 사항 탭에서 **정보를 제공합니다. 

    | 설정 | 값 |
    | -- | -- |
    | 구독 | *구독* |
    | 리소스 그룹 | **az104-rg4** |
    | 이름 | `myNSGSecure` |
    | 지역 | **(미국) 미국 동부**  |

1. 검토 + 만들기를 클릭한 **다음 유효성 검사 후 만들기**를 클릭합니다**.**

1. NSG를 만든 후 리소스**로 이동을 클릭합니다**.

1. 설정** 아래에서 **서브넷**을 클릭한 **다음 **연결**합니다.

    | 설정 | 값 |
    | -- | -- |
    | 가상 네트워크 | **CoreServicesVnet(az104-rg4)** |
    | 서브넷 | **SharedServicesSubnet** |

1. 확인을** 클릭하여 **연결을 저장합니다.

### 인바운드 보안 규칙 구성

1. **설정** 영역에서 인바운드 보안 규칙을** 선택합니다**.

1. 기본 인바운드 규칙을 검토합니다. 다른 가상 네트워크 및 부하 분산 장치만 액세스할 수 있습니다.

1. **+ 추가**를 선택합니다.

1. **인바운드 포트 규칙** 추가 블레이드에서 다음 정보를 사용하여 인바운드 포트 규칙을 추가한 다음 추가**를 선택합니다**.

    | 설정 | 값 |
    | -- | -- |
    | 원본 | **any** |
    | 원본 포트 범위 |  ***** |
    | 대상 | **애플리케이션 보안 그룹** |
    | 대상 애플리케이션 보안 그룹 | **asg-web** |
    | 서비스 | **사용자 지정** (다른 선택 사항 확인) |
    | 대상 포트 범위 | **80,443** |
    | 프로토콜 | **TCP** |
    | 작업 | **허용** |
    | 우선 순위 | **100** |
    | 이름 | **AllowASG** |

1. NSG 규칙을 만든 후 잠시 시간을 내어 기본 **나가는 보안 규칙을** 검토합니다.

## 핵심 내용

랩을 완료한 것을 축하합니다. 다음은 이 랩에 대한 기본 설명입니다. 

+ 가상 네트워크는 클라우드의 사용자 네트워크를 나타내는 표현입니다. 
+ 가상 네트워크를 디자인할 때 IP 주소 범위가 겹치지 않도록 하는 것이 좋습니다. 이렇게 하면 문제가 줄어들고 문제 해결이 간소화됩니다.
+ 서브넷은 가상 네트워크 내 IP 주소의 범위입니다. 조직 및 보안을 위해 가상 네트워크를 여러 서브넷으로 나눌 수 있습니다.
+ 네트워크 보안 그룹에는 네트워크 트래픽을 허용하거나 거부하는 보안 규칙이 포함되어 있습니다. 필요에 맞게 사용자 지정할 수 있는 기본 들어오고 나가는 규칙이 있습니다.
+ 애플리케이션 보안 그룹은 웹 서버 또는 데이터베이스 서버와 같은 일반적인 기능을 사용하여 서버 그룹을 보호하는 데 사용됩니다. 

## 리소스 정리

고유한 구독으로 작업하는 경우 랩 리소스를 삭제하는 데 1분이 소요됩니다. 이렇게 하면 리소스가 해제되고 비용이 최소화됩니다. 랩 리소스를 삭제하는 가장 쉬운 방법은 랩 리소스 그룹을 삭제하는 것입니다. 

+ Azure Portal에서 리소스 그룹을 선택하고, 리소스 그룹 삭제를 선택하고 **, **리소스 그룹** 이름을** 입력한 다음, 삭제**를 클릭합니다**.

+ Azure PowerShell 사용. `Remove-AzResourceGroup -Name resourceGroupName` 

+ CLI `az group delete --name resourceGroupName`를 사용하여 .
