---
lab:
  title: '랩 03: Azure Resource Manager 템플릿을 사용하여 Azure 리소스 관리'
  module: Administer Azure Resources
---

# 랩 03 - Azure Resource Manager 템플릿을 사용하여 Azure 리소스 관리

## 랩 소개

이 랩에서는 Azure Resource Manager 템플릿을 사용하여 리소스 인프라를 정의하는 방법을 알아봅니다. 템플릿은 일관성을 보장하고 한 번에 여러 리소스를 만들 수 있습니다. Azure Portal, Azure PowerShell 또는 CLI를 사용하여 템플릿을 배포하는 방법을 알아봅니다. 

이 랩에는 Azure 구독이 필요합니다. 구독 유형은 이 랩의 기능 가용성에 영향을 줄 수 있습니다. 지역을 변경할 수 있지만 단계는 미국** 동부를 사용하여 **작성됩니다. 

## 예상 소요 시간: 40분

## 대화형 랩 시뮬레이션

이 항목에 유용할 수 있는 대화형 랩 시뮬레이션이 있습니다. 시뮬레이션을 사용하면 비슷한 시나리오를 원하는 속도로 클릭할 수 있습니다. 대화형 시뮬레이션과 이 랩 사이에는 차이점이 있지만, 대부분의 핵심 개념은 동일합니다. Azure 구독은 필요하지 않습니다. 

+ [템플릿](https://mslearn.cloudguides.com/en-us/guides/AZ-900%20Exam%20Guide%20-%20Azure%20Fundamentals%20Exercise%209)을 사용하여 가상 머신을 만듭니다. 빠른 시작 템플릿을 사용하여 가상 머신을 배포합니다.
  
+ [Azure Resource Manager 템플릿을 사용하여 Azure 리소스를 관리합니다](https://mslabs.cloudguides.com/guides/AZ-104%20Exam%20Guide%20-%20Microsoft%20Azure%20Administrator%20Exercise%205). 템플릿을 사용하여 관리 디스크를 검토, 만들기 및 배포합니다.

## 랩 시나리오

팀은 리소스 프로비전 및 리소스 그룹을 기반으로 구성과 같은 기본 Azure 관리 기능을 살펴보했습니다. 다음으로, 팀은 배포를 자동화하고 간소화하는 방법을 찾고자 합니다. 조직에서는 관리자가 보다 복잡하거나 창의적인 작업을 수행할 수 있도록 관리 오버헤드를 줄이고, 사용자 오류를 줄이거나 일관성을 높이기 위해 자동화를 찾는 경우가 많습니다.

## 아키텍처 다이어그램

![작업의 다이어그램.](../media/az104-lab03b-architecture-diagram.png)

## 작업

+ 작업 1: Azure 관리 디스크 배포를 위한 Azure Resource Manager 템플릿을 만듭니다.
+ 작업 2: Azure Resource Manager 템플릿을 편집한 다음 템플릿을 사용하여 Azure 관리 디스크를 만듭니다.
+ 작업 3: 관리 디스크의 Azure Resource Manager 템플릿 기반 배포를 검토합니다.
+ 작업 4: Azure Bicep을 사용하여 관리 디스크를 배포합니다.
+ 작업 5: Azure PowerShell을 사용하여 템플릿 배포(옵션 1).
+ 작업 5: CLI를 사용하여 템플릿을 배포합니다(옵션 2). 


## 작업 1: Azure 관리 디스크 배포를 위한 Azure Resource Manager 템플릿 만들기

이 작업에서는 Azure Portal을 사용하여 Azure Resource Manager 템플릿을 생성합니다. 그런 다음 이후 배포에서 사용할 템플릿을 다운로드할 수 있습니다. 수백 또는 수천 개의 디스크를 배포하려는 조직은 하나 이상의 템플릿을 활용하여 배포를 자동화할 수 있습니다. 

1. **Azure Portal** - `https://portal.azure.com`에 로그인합니다.

1. `Disks`을 검색하고 선택합니다.

1. 디스크 페이지에서 만들기**를 선택합니다**.

1. 관리 디스크 만들기 페이지에서 다음 정보를 사용하여 디스크를 만듭니다.
    
    | 설정 | 값 |
    | --- | --- |
    | 구독 | *구독* | 
    | 리소스 그룹 | `az104-rg3` (필요한 ** 경우새로 만듭니다**.)
    | 디스크 이름 | `az104-disk1` | 
    | 지역 | **미국 동부** |
    | 가용성 영역 | **인프라 중복 필요 없음** | 
    | 소스 형식 | **없음** |
    | 크기 | **32gb** | 
    | 성능 | **표준 HDD** |

1. 검토 + 만들기***를 한 번* 클릭합니다**. 리소스를 배포하지 마세요****.

1. 유효성 검사를 마친 후 자동화**를 위한 템플릿 다운로드(페이지 아래쪽)를 클릭합니다**.

1. 템플릿에 표시된 정보를 검토합니다. 템플릿** 및 **매개 변수** 탭을 **모두 검토합니다.

1. 다운로드**를 클릭하고 **템플릿을 컴퓨터에 저장합니다.

1. 다운로드한 파일의 콘텐츠를 컴퓨터의 다운로드 폴더로 **추출합니다** . 두 개의 JSON 파일(템플릿 및 매개 변수)이 있습니다. 

1. **파일 탐색기** 창을 모두 닫습니다.

1. Azure Portal에서 관리 디스크 배포를 취소합니다.

## 작업 2: Azure Resource Manager 템플릿을 편집한 다음 템플릿을 사용하여 Azure 관리 디스크 만들기

이 작업에서는 만든 템플릿을 사용하여 새 관리 디스크를 배포합니다. 이 작업은 배포를 빠르고 쉽게 반복할 수 있도록 템플릿 기반 배포를 수행하는 일반적인 프로세스를 간략하게 설명합니다. 매개 변수를 한두 개 변경해야 하는 경우 나중에 템플릿을 쉽게 수정할 수 있습니다.

1. Azure Portal에서 검색하여 선택합니다 `Deploy a custom template`.

1. **사용자 지정 배포** 블레이드에서 빠른 시작 템플릿**을 사용할 **수 있습니다. 많은 기본 제공 템플릿이 있습니다. 템플릿을 선택하면 간단한 설명이 표시됩니다.

1. 빠른 시작을 사용하는 대신 편집**기에서 고유한 템플릿 빌드를 선택합니다**.

1. **템플릿 편집** 블레이드에서 **파일 로드**를 클릭하고 이전 작업에서 다운로드한 **template.json** 파일을 업로드합니다.

1. 편집기 창에서 다음 줄을 제거합니다. 닫는 대괄호와 쉼표를 제거해야 합니다. 

   ```
    "sourceResourceId": {
            "type": "string"
    },
   ```
   
   ```
      "hyperVGeneration": {
       "defaultValue": "V1",
       "type": "String"
   },      
   ```

    >**참고**: 이러한 매개 변수는 현재 배포에 적용할 수 없으므로 제거됩니다. SourceResourceId, sourceUri, osType 및 hyperVGeneration 매개 변수는 기존 VHD 파일에서 Azure 디스크를 만드는 데 적용할 수 있습니다.

1. 변경 내용을 **저장**합니다.

1. **사용자 지정 배포** 블레이드로 돌아가서 **매개 변수 편집**을 클릭합니다. 

1. **매개 변수 편집** 블레이드에서 **파일 로드**를 클릭하고 이전 작업에서 다운로드한 **parameters.json** 파일을 업로드한 후 변경 내용을 **저장**합니다.

1. **사용자 지정 배포** 블레이드로 돌아가서 다음 설정을 지정합니다.

    | 설정 | 값 |
    | --- |--- |
    | 구독 | *구독* |
    | 리소스 그룹 | `az104-rg3` |
    | 지역 | **미국 동부** |
    | 디스크 이름 | `az104-disk1` |
    | 위치 | 이전 작업에서 메모해 둔 location 매개 변수의 값 |
    | SKU | **Standard_LRS** |
    | 디스크 크기(GB) | **32** |
    | 옵션 만들기 | **empty** |
    | 디스크 암호화 집합 유형 | **EncryptionAtRestWithPlatformKey** |
    | 데이터 액세스 인증 모드 | 없음 |
    | 네트워크 액세스 정책 | **AllowAll** |
    | 공용 네트워크 액세스 | 사용 안 함 |

1. **검토 + 생성**를 선택한 다음, **생성**를 선택합니다.

1. 배포가 성공적으로 완료되었는지 확인합니다.

## 작업 3: 관리 디스크의 Azure Resource Manager 템플릿 기반 배포 검토

이 작업에서는 배포가 성공적으로 완료되었는지 확인합니다. 모든 이전 배포는 배포가 대상으로 지정된 리소스 그룹에 설명되어 있습니다. 이 검토에서는 배포 시간 및 기간에 대한 세부 정보를 보여 줍니다. 이는 문제 해결 시 유용할 수 있습니다. 대규모 작업에 템플릿을 사용하기 전에 성공을 보장하기 위해 처음 몇 가지 템플릿 기반 배포를 검토하는 것이 좋습니다.

1. Azure Portal에서 **리소스 그룹**을 검색하고 선택합니다. 

1. 리소스 그룹 목록에서 az104-rg3**을 클릭합니다**.

1. az104-rg3** 리소스 그룹 블레이드의 **설정** 섹션에서 배포**를 클릭합니다**.**

1. **az104-rg3 - 배포 블레이드에서 배포** 목록의 첫 번째 항목을 클릭하고 입력** 및 **템플릿** 블레이드의 **콘텐츠를 검토합니다.

1. Azure Portal에서 **디스크**를 검색하여 선택합니다.

1. 관리 디스크가 만들어졌습니다.

    >**참고:** 명령줄에서 템플릿을 배포할 수도 있습니다. 작업 4, 옵션 1은 PowerShell을 사용하는 방법을 보여줍니다. 작업 5, 옵션 2는 CLI를 사용하는 방법을 보여줍니다.

## 작업 4: Azure Bicep을 사용하여 리소스 배포

이 작업에서는 Bicep 파일을 사용하여 리소스 그룹에 스토리지 계정을 배포합니다. Bicep은 ARM 템플릿을 기반으로 하는 선언적 자동화 도구이지만 더 쉽게 읽고 작업할 수 있습니다.

1. Cloud Shell **Bash** 세션을 엽니다. 필요한 경우 고급** 링크를 사용하여 **스토리지를 구성합니다. 

1. **Cloud Shell 메뉴 모음에서 파일** 업로드/다운로드 아이콘을 선택합니다. 이는 위쪽 및 아래쪽 화살표가 있는 문서 아이콘으로 표시됩니다.

1. **업로드**를 선택합니다. \Allfiles\Lab03 디렉터리를 찾고 Bicep 템플릿 파일 **azuredeploy.bicep**을 선택합니다.

1. 파일이 업로드되었는지 확인하려면 Cloud Shell 메뉴에서 이중 대괄호 아이콘을 선택하여 기본 제공 편집기를 엽니다.

1. 파일은 왼쪽의 탐색 트리에 나열되어야 합니다. 내용을 확인하려면 선택합니다.

   ![클라우드 셸 편집기의 bicep 파일 스크린샷](../media/az104-lab03d-editor.png)

1. 잠시 시간을 내어 bicep 템플릿 파일을 읽어보십시오. 스토리지(stg) 리소스가 어떻게 정의되는지 확인합니다. 매개 변수 및 허용된 값이 어떻게 구성되는지 확인합니다.
   
1. az104-rg3** 리소스 그룹에 Bicep 파일을 **배포하려면 다음을 실행합니다.

   ```sh
   az deployment group create --resource-group az104-rg3 --template-file azuredeploy.bicep
   ```

1. 스토리지 문자열 값을 묻는 메시지가 표시되면 .를 입력합니다 `az104`. 템플릿 파일은 임의로 생성된 문자열과 함께 문자열을 사용하여 고유한 배포 이름을 만듭니다.

1. Cloud Shell을 닫고 전체 Azure Portal로 돌아갑니다. 

1. 스토리지 계정을** 검색하고 선택합니다**. az104-rg3**** 리소스 그룹에 az104라는 **스토리지 계정이 만들어졌**는지 확인합니다.

## 작업 5. Azure PowerShell을 사용하여 템플릿을 배포합니다(옵션 1).

1. Cloud Shell을 열고 PowerShell을** 선택합니다**.

1. 필요한 경우 고급** 설정을 사용하여 **Cloud Shell에 대한 디스크 스토리지를 만듭니다.

1. Cloud Shell에서 업로드** 아이콘을 **사용하여 템플릿 및 매개 변수 파일을 업로드합니다. 각 파일을 개별적으로 업로드해야 합니다.

1. Cloud Shell 스토리지에서 파일을 사용할 수 있는지 확인합니다.

    ```powershell
    dir
    ```

1. Cloud Shell에서 편집기** 아이콘을 **선택하고 매개 변수 JSON 파일로 이동합니다.

1. 변경합니다. 예를 들어 디스크 이름을 **az104-disk2**로 변경합니다. 

    >**참고**: 리소스 그룹, 구독, 관리 그룹 또는 테넌트에 템플릿 배포를 대상으로 지정할 수 있습니다. 배포의 범위에 따라 다른 명령을 사용합니다.

1. 리소스 그룹에 배포하려면 **New-AzResourceGroupDeployment**를 사용합니다.

    ```powershell
    New-AzResourceGroupDeployment -ResourceGroupName az104-rg3 -TemplateFile template.json -TemplateParameterFile parameters.json
    ```
1. 명령이 완료되고 ProvisioningState가 **성공했는지** 확인합니다.
   
## 작업 6: CLI를 사용하여 템플릿 배포(옵션 2)

1. Cloud Shell을 열고 Bash**를 선택합니다**.

1. 필요한 경우 고급** 설정을 사용하여 **Cloud Shell에 대한 디스크 스토리지를 만듭니다.

1. Cloud Shell에서 업로드** 아이콘을 **사용하여 템플릿 및 매개 변수 파일을 업로드합니다. 각 파일을 개별적으로 업로드해야 합니다.

1. Cloud Shell 스토리지에서 파일을 사용할 수 있는지 확인합니다.

    ```sh
    dir
    ```

1. Cloud Shell에서 편집기** 아이콘을 **선택하고 매개 변수 JSON 파일로 이동합니다.

1. 변경합니다. 예를 들어 디스크 이름을 **az104-disk2**로 변경합니다. 

    >**참고**: 리소스 그룹, 구독, 관리 그룹 또는 테넌트에 템플릿 배포를 대상으로 지정할 수 있습니다. 배포의 범위에 따라 다른 명령을 사용합니다.

1. 리소스 그룹에 배포하려면 **az deployment group create**를 사용합니다.

    ```sh
    az deployment group create --resource-group az104-rg3 --template-file template.json --parameters parameters.json
    ```
1. 명령이 완료되고 ProvisioningState가 **성공했는지** 확인합니다.



## 핵심 내용

랩을 완료한 것을 축하합니다. 다음은 이 랩에 대한 기본 설명입니다. 

+ Azure Resource Manager 템플릿을 사용하면 이러한 리소스를 개별적으로 처리하는 대신 솔루션에 대한 모든 리소스를 그룹으로 배포, 관리 및 모니터링할 수 있습니다.
+ Azure Resource Manager 템플릿은 스크립트가 아닌 선언적으로 인프라를 관리할 수 있는 JSON(JavaScript Object Notation) 파일입니다.
+ 템플릿에서 매개 변수를 인라인 값으로 전달하는 대신 매개 변수 값을 포함하는 별도의 JSON 파일을 사용할 수 있습니다.
+ Azure Resource Manager 템플릿은 Azure Portal, Azure PowerShell 및 CLI를 비롯한 다양한 방법으로 배포할 수 있습니다.

## 리소스 정리

고유한 구독으로 작업하는 경우 랩 리소스를 삭제하는 데 1분이 소요됩니다. 이렇게 하면 리소스가 해제되고 비용이 최소화됩니다. 랩 리소스를 삭제하는 가장 쉬운 방법은 랩 리소스 그룹을 삭제하는 것입니다. 

+ Azure Portal에서 리소스 그룹을 선택하고, 리소스 그룹 삭제를 선택하고 **, **리소스 그룹** 이름을** 입력한 다음, 삭제**를 클릭합니다**.
+ Azure PowerShell 사용. `Remove-AzResourceGroup -Name resourceGroupName` 
+ CLI `az group delete --name resourceGroupName`를 사용하여 .
